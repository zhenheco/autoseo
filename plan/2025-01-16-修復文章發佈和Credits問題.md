## ğŸ”§ å®Œæ•´ä¿®å¾©è¨ˆåŠƒï¼šæ¸¬è©¦é©…å‹•çš„å•é¡Œè§£æ±ºæ–¹æ¡ˆ

### ğŸ“Š éšæ®µ 1ï¼šç³»çµ±è¨ºæ–·ï¼ˆä½¿ç”¨ CLI/MCP å·¥å…·ï¼‰

#### 1.1 è³‡æ–™åº«è¨ºæ–·ï¼ˆä½¿ç”¨ psqlï¼‰

```bash
# é€£æ¥åˆ° Supabase è³‡æ–™åº«
psql "$SUPABASE_DB_URL"

# æª¢æŸ¥é—œéµè¡¨çµæ§‹
\d company_subscriptions
\d generated_articles
\d website_configs
\d token_usage_logs

# æª¢æŸ¥ç•¶å‰ credits é¤˜é¡
SELECT id, company_id, monthly_quota_balance, purchased_token_balance, status
FROM company_subscriptions
WHERE status = 'active';

# æª¢æŸ¥æœ€è¿‘çš„æ–‡ç« ç”Ÿæˆè¨˜éŒ„
SELECT id, title, status, wordpress_status, created_at, word_count
FROM generated_articles
ORDER BY created_at DESC
LIMIT 10;

# æª¢æŸ¥ token ä½¿ç”¨è¨˜éŒ„ï¼ˆé©—è­‰æ˜¯å¦æœ‰æ‰£é™¤ï¼‰
SELECT * FROM token_usage_logs
ORDER BY created_at DESC
LIMIT 10;

# æª¢æŸ¥ WordPress ç¶²ç«™é…ç½®
SELECT id, name, wordpress_url, wordpress_username
FROM website_configs
WHERE is_active = true;
```

#### 1.2 WordPress API é€£é€šæ€§æ¸¬è©¦ï¼ˆä½¿ç”¨ curlï¼‰

```bash
# å¾è³‡æ–™åº«ç²å– WordPress é…ç½®å¾Œæ¸¬è©¦
# æ¸¬è©¦ 1: é©—è­‰èªè­‰
curl -i \
  -H "Authorization: Basic $(echo -n 'USERNAME:APP_PASSWORD' | base64)" \
  https://YOUR_WORDPRESS_SITE/wp-json/wp/v2/users/me

# æ¸¬è©¦ 2: ç²å–æ–‡ç« åˆ—è¡¨
curl -i \
  -H "Authorization: Basic $(echo -n 'USERNAME:APP_PASSWORD' | base64)" \
  https://YOUR_WORDPRESS_SITE/wp-json/wp/v2/posts?per_page=1

# æ¸¬è©¦ 3: å»ºç«‹æ¸¬è©¦è‰ç¨¿
curl -X POST \
  -H "Authorization: Basic $(echo -n 'USERNAME:APP_PASSWORD' | base64)" \
  -H "Content-Type: application/json" \
  -d '{"title":"API Test","content":"Test from CLI","status":"draft"}' \
  https://YOUR_WORDPRESS_SITE/wp-json/wp/v2/posts
```

#### 1.3 å‰ç«¯ç‹€æ…‹æª¢æŸ¥ï¼ˆä½¿ç”¨ chrome-devtools skillï¼‰

- æ‰“é–‹ http://localhost:3168/dashboard/articles
- æª¢æŸ¥ Console éŒ¯èª¤
- æª¢æŸ¥ Network è«‹æ±‚
- æª¢æŸ¥æ–‡ç« åˆ—è¡¨æ¸²æŸ“ï¼ˆæ¨™é¡Œå¤§å°ã€ç‹€æ…‹åœ–ç¤ºï¼‰

---

### ğŸ› ï¸ éšæ®µ 2ï¼šä»£ç¢¼ä¿®å¾©

#### 2.1 WordPress ç™¼ä½ˆåŠŸèƒ½ä¿®å¾© âš ï¸ å„ªå…ˆç´š P0

**æª”æ¡ˆ**: `src/app/api/articles/[id]/publish/route.ts`

**ä¿®å¾©å…§å®¹**:

1. æ–°å¢å®Œæ•´çš„ WordPress API ç™¼ä½ˆé‚è¼¯
2. å¯¦ä½œéŒ¯èª¤è™•ç†å’Œå›æ»¾æ©Ÿåˆ¶
3. å„²å­˜ WordPress post ID å’Œ URL

**å¯¦ä½œæ­¥é©Ÿ**:

```typescript
// 1. ç²å–æ–‡ç« å…§å®¹
const { data: article } = await supabase
  .from("generated_articles")
  .select("*")
  .eq("id", id)
  .single();

// 2. ç²å– WordPress é…ç½®
const { data: website } = await supabase
  .from("website_configs")
  .select("*")
  .eq("id", website_id)
  .single();

// 3. å»ºç«‹ WordPress API client
const wpAuth = Buffer.from(
  `${website.wordpress_username}:${website.wordpress_app_password}`,
).toString("base64");

// 4. ç™¼ä½ˆåˆ° WordPress
const wpResponse = await fetch(`${website.wordpress_url}/wp-json/wp/v2/posts`, {
  method: "POST",
  headers: {
    Authorization: `Basic ${wpAuth}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    title: article.title,
    content: article.html_content,
    status: publishStatus, // 'publish' or 'draft'
  }),
});

// 5. æ›´æ–°è³‡æ–™åº«ï¼ˆå« WordPress post IDï¼‰
const wpPost = await wpResponse.json();
await supabase
  .from("generated_articles")
  .update({
    wordpress_post_id: wpPost.id,
    wordpress_post_url: wpPost.link,
    wordpress_status: publishStatus,
    status: "published",
  })
  .eq("id", id);
```

#### 2.2 æ–‡ç« ç‹€æ…‹é¡¯ç¤ºä¿®å¾© âš ï¸ å„ªå…ˆç´š P1

**æª”æ¡ˆ 1**: `src/components/articles/ArticleStatusIcon.tsx`

**ä¿®å¾©å…§å®¹**:

1. åŠ å…¥ `published` ç‹€æ…‹æ”¯æ´ï¼ˆç´…è‰²åœ“åœˆï¼‰
2. åŠ å…¥ `wordpressStatus` prop
3. é¡¯ç¤ºç™¼ä½ˆè³‡è¨Š tooltip

**æª”æ¡ˆ 2**: `src/app/(dashboard)/dashboard/articles/page.tsx`

**ä¿®å¾©å…§å®¹**:

1. å‚³é `wordpressStatus` çµ¦ `ArticleStatusIcon`
2. åœ¨åˆ—è¡¨ä¸­é¡¯ç¤ºç™¼ä½ˆç¶²ç«™å’Œæ™‚é–“

#### 2.3 Credits æ‰£é™¤å•é¡Œä¿®å¾© âš ï¸ å„ªå…ˆç´š P0

**è¨ºæ–·ç™¼ç¾**:

- Token æ‰£é™¤é‚è¼¯å·²å­˜åœ¨
- å•é¡Œå¯èƒ½åœ¨ cron job åŸ·è¡Œéšæ®µ
- éœ€è¦åŠ å¼·æ—¥èªŒè¿½è¹¤

**ä¿®å¾©å…§å®¹**:

1. åŠ å…¥è©³ç´°æ—¥èªŒè¨˜éŒ„ï¼ˆæ¯å€‹æ­¥é©Ÿçš„ token ä½¿ç”¨ï¼‰
2. åœ¨æ–‡ç« ç”Ÿæˆå®Œæˆå¾Œé¡¯ç¤º token ä½¿ç”¨æ˜ç´°
3. å»ºç«‹ token ä½¿ç”¨æ­·å²æŸ¥è©¢ API
4. ç¢ºä¿ idempotency key æ­£ç¢ºä½¿ç”¨

**æ–°å¢åŠŸèƒ½**:

- ç®¡ç†å“¡é é¢é¡¯ç¤º token ä½¿ç”¨æ­·å²
- æ–‡ç« è©³æƒ…é é¡¯ç¤ºè©²æ–‡ç« çš„ token æ¶ˆè€—

#### 2.4 æ–‡ç« åˆ—è¡¨æ¨£å¼å„ªåŒ– ğŸ¨ å„ªå…ˆç´š P2

**æª”æ¡ˆ**: `src/app/(dashboard)/dashboard/articles/page.tsx`

**ä¿®å¾©å…§å®¹**:

```typescript
// æ¨™é¡Œè®Šå¤§
<h3 className="text-base font-semibold truncate">{item.title}</h3>

// Meta è³‡æ–™ä¿æŒè¼ƒå°
<div className="flex gap-3 text-xs text-muted-foreground mt-1">
  <span>{new Date(item.created_at).toLocaleDateString('zh-TW')}</span>
  <span>å­—æ•¸: {item.article.word_count || 0}</span>
  {item.article.quality_score && (
    <span>å“è³ª: {item.article.quality_score}åˆ†</span>
  )}
  {/* æ–°å¢ï¼šç™¼ä½ˆè³‡è¨Š */}
  {item.status === 'published' && item.wordpress_post_url && (
    <span className="text-green-600">
      å·²ç™¼ä½ˆåˆ° {item.published_to_website_name}
    </span>
  )}
</div>
```

---

### âœ… éšæ®µ 3ï¼šæ¸¬è©¦é©—è­‰ï¼ˆä½¿ç”¨ç›¸åŒçš„ CLI/MCP å·¥å…·ï¼‰

#### 3.1 WordPress ç™¼ä½ˆæ¸¬è©¦

```bash
# æ¸¬è©¦ 1: é€é API ç™¼ä½ˆæ–‡ç« 
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"website_id":"xxx","publish_status":"draft"}' \
  http://localhost:3168/api/articles/{ARTICLE_ID}/publish

# æ¸¬è©¦ 2: é©—è­‰ WordPress ä¸Šæ˜¯å¦å‡ºç¾æ–‡ç« 
curl -H "Authorization: Basic $(echo -n 'USERNAME:APP_PASSWORD' | base64)" \
  https://YOUR_WORDPRESS_SITE/wp-json/wp/v2/posts?search=æ–‡ç« æ¨™é¡Œ

# æ¸¬è©¦ 3: æª¢æŸ¥è³‡æ–™åº«æ›´æ–°
psql "$SUPABASE_DB_URL" -c \
  "SELECT wordpress_post_id, wordpress_post_url, wordpress_status
   FROM generated_articles
   WHERE id = 'ARTICLE_ID';"
```

#### 3.2 Credits æ‰£é™¤é©—è­‰

```bash
# æ¸¬è©¦ 1: è¨˜éŒ„ç•¶å‰é¤˜é¡
psql "$SUPABASE_DB_URL" -c \
  "SELECT monthly_quota_balance, purchased_token_balance
   FROM company_subscriptions
   WHERE status = 'active';"

# æ¸¬è©¦ 2: ç”Ÿæˆä¸€ç¯‡æ–‡ç« 

# æ¸¬è©¦ 3: é©—è­‰é¤˜é¡æ˜¯å¦æ¸›å°‘
psql "$SUPABASE_DB_URL" -c \
  "SELECT monthly_quota_balance, purchased_token_balance
   FROM company_subscriptions
   WHERE status = 'active';"

# æ¸¬è©¦ 4: æª¢æŸ¥ token ä½¿ç”¨è¨˜éŒ„
psql "$SUPABASE_DB_URL" -c \
  "SELECT * FROM token_usage_logs
   ORDER BY created_at DESC
   LIMIT 5;"
```

#### 3.3 å‰ç«¯é©—è­‰ï¼ˆä½¿ç”¨ chrome-devtools skillï¼‰

- æª¢æŸ¥æ–‡ç« åˆ—è¡¨çš„æ¨™é¡Œå¤§å°
- é©—è­‰å·²ç™¼ä½ˆæ–‡ç« çš„ç´…è‰²åœ“åœˆç‹€æ…‹
- ç¢ºèªæ²’æœ‰ Console éŒ¯èª¤
- é©—è­‰ç™¼ä½ˆè³‡è¨Šé¡¯ç¤º

---

### ğŸ“ˆ éšæ®µ 4ï¼šç›£æ§æ©Ÿåˆ¶å»ºç«‹

#### 4.1 æ—¥èªŒå¢å¼·

- åœ¨ orchestrator æ¯å€‹æ­¥é©ŸåŠ å…¥æ—¥èªŒ
- è¨˜éŒ„ token è¨ˆç®—éç¨‹
- è¨˜éŒ„ WordPress API å‘¼å«çµæœ

#### 4.2 éŒ¯èª¤è¿½è¹¤

- åœ¨ API è·¯ç”±åŠ å…¥éŒ¯èª¤æ•ç²
- å»ºç«‹éŒ¯èª¤æ—¥èªŒè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çµ¦ç”¨æˆ¶

#### 4.3 å»ºç«‹æ¸¬è©¦è…³æœ¬

**æª”æ¡ˆ**: `scripts/test-wordpress-publish.sh`

```bash
#!/bin/bash
# è‡ªå‹•åŒ–æ¸¬è©¦ WordPress ç™¼ä½ˆåŠŸèƒ½

echo "Testing WordPress publish functionality..."

# 1. Get WordPress config from DB
# 2. Test API connectivity
# 3. Create test article
# 4. Publish to WordPress
# 5. Verify on WordPress
# 6. Clean up test data
```

---

## ğŸ“‹ åŸ·è¡Œæ™‚é–“è¡¨

1. **éšæ®µ 1ï¼šè¨ºæ–·** (20 åˆ†é˜)
   - è³‡æ–™åº«æŸ¥è©¢å’Œåˆ†æ
   - WordPress API æ¸¬è©¦
   - å‰ç«¯ç‹€æ…‹æª¢æŸ¥

2. **éšæ®µ 2ï¼šä¿®å¾©** (60 åˆ†é˜)
   - WordPress ç™¼ä½ˆåŠŸèƒ½ (30 åˆ†é˜)
   - Credits æ‰£é™¤æ—¥èªŒ (15 åˆ†é˜)
   - ç‹€æ…‹é¡¯ç¤º (10 åˆ†é˜)
   - æ¨£å¼èª¿æ•´ (5 åˆ†é˜)

3. **éšæ®µ 3ï¼šé©—è­‰** (20 åˆ†é˜)
   - é‡æ–°åŸ·è¡Œæ‰€æœ‰è¨ºæ–·æ¸¬è©¦
   - ç«¯åˆ°ç«¯æ¸¬è©¦
   - Chrome DevTools æª¢æŸ¥

4. **éšæ®µ 4ï¼šç›£æ§** (10 åˆ†é˜)
   - å»ºç«‹æ¸¬è©¦è…³æœ¬
   - åŠ å…¥é•·æœŸç›£æ§

**ç¸½è¨ˆ**: ~110 åˆ†é˜

---

## âœ… é©—è­‰æ¨™æº–

- [ ] WordPress ç™¼ä½ˆæˆåŠŸï¼ˆåœ¨ WordPress ç¶²ç«™ä¸Šå¯è¦‹ï¼‰
- [ ] å·²ç™¼ä½ˆæ–‡ç« é¡¯ç¤ºç´…è‰²åœ“åœˆç‹€æ…‹
- [ ] Credits åœ¨æ–‡ç« ç”Ÿæˆå¾Œæ­£ç¢ºæ‰£é™¤
- [ ] Token ä½¿ç”¨è¨˜éŒ„å¯æŸ¥è©¢
- [ ] æ–‡ç« æ¨™é¡Œå­—é«”æ¯” meta è³‡æ–™å¤§
- [ ] ç„¡å‰ç«¯ Console éŒ¯èª¤
- [ ] `pnpm run build` æˆåŠŸé€šé
- [ ] æ‰€æœ‰ psql æŸ¥è©¢è¿”å›é æœŸçµæœ
- [ ] curl æ¸¬è©¦å…¨éƒ¨é€šé
