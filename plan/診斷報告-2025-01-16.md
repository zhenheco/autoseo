# ç³»çµ±è¨ºæ–·å ±å‘Š

**æ—¥æœŸ**: 2025-01-16
**è¨ºæ–·éšæ®µ**: éšæ®µ 1.1 - è³‡æ–™åº«è¨ºæ–·

---

## ğŸ” è¨ºæ–·çµæœç¸½çµ

### 1. WordPress ç™¼ä½ˆåŠŸèƒ½å•é¡Œ âŒ **ï¼ˆP0 - åš´é‡ï¼‰**

**è­‰æ“š**:

```sql
id: 46be251a-dc81-4b17-9a52-262b09cf4fe1
title: 5å€‹æ–¹æ³•ç¢ºä¿AIå¯«ä½œå…§å®¹çš„æ­£ç¢ºæ€§ï½œå¯¦ç”¨æŠ€å·§æŒ‡å—
status: published
wordpress_status: draft
wordpress_post_id: NULL  â† é—œéµå•é¡Œï¼
```

**å•é¡Œåˆ†æ**:

1. æ–‡ç« ç‹€æ…‹å·²æ¨™è¨˜ç‚º `published`
2. WordPress ç‹€æ…‹ç‚º `draft`
3. **ä½† `wordpress_post_id` ç‚º NULL** â†’ è­‰æ˜æ²’æœ‰å¯¦éš›ç™¼ä½ˆåˆ° WordPress

**æ ¹æœ¬åŸå› **:

- API è·¯ç”± `/api/articles/[id]/publish` åªæ›´æ–°è³‡æ–™åº«ç‹€æ…‹
- ç¼ºå°‘å¯¦éš›çš„ WordPress REST API å‘¼å«
- æ²’æœ‰å„²å­˜ WordPress å›å‚³çš„ post ID å’Œ URL

**é¡å¤–ç™¼ç¾**:

```sql
website_configs:
- website_name: æŒ¯ç¦¾ç©ºæ‹
- wordpress_url: https://zhenhe-co.com
- wp_username: zhenhe
- wp_enabled: false  â† å¯èƒ½å°è‡´ç™¼ä½ˆå¤±æ•—
- is_active: true
```

---

### 2. Credits æ‰£é™¤å•é¡Œ âš ï¸ **ï¼ˆP0 - åš´é‡ï¼‰**

**è­‰æ“š A - token_usage_logs è¡¨**:

```sql
SELECT * FROM token_usage_logs;
-- çµæœ: 0 rows ï¼ˆå®Œå…¨ç©ºç™½ï¼ï¼‰
```

**è­‰æ“š B - token_deduction_records è¡¨**:

```sql
SELECT * FROM token_deduction_records;
-- çµæœ: 0 rows ï¼ˆå®Œå…¨ç©ºç™½ï¼ï¼‰
```

**è­‰æ“š C - company_subscriptions è¡¨**:

```sql
æœˆåº¦é…é¡é¤˜é¡: 50,000 tokens
è³¼è²·é…é¡é¤˜é¡: 0 tokens
ç¸½é¤˜é¡: 50,000 tokens ï¼ˆæœªæ‰£é™¤ä»»ä½•ä½¿ç”¨é‡ï¼‰
```

**å•é¡Œåˆ†æ**:
å·²ç”Ÿæˆ 5+ ç¯‡æ–‡ç« ï¼ˆæ¯ç¯‡ç´„ 1,800-2,000 å­—ï¼‰ï¼Œä½†ï¼š

- âŒ æ²’æœ‰ä»»ä½• token ä½¿ç”¨è¨˜éŒ„
- âŒ æ²’æœ‰ä»»ä½•æ‰£é™¤è¨˜éŒ„
- âŒ é¤˜é¡æœªæ¸›å°‘

**æ ¹æœ¬åŸå› æ¨æ–·**:

1. **æœ€å¯èƒ½**ï¼šOrchestrator æ ¹æœ¬æ²’æœ‰è¢«åŸ·è¡Œ
   - API å»ºç«‹ job å¾Œç«‹å³è¿”å›
   - Cron job æœªè§¸ç™¼æˆ–å¤±æ•—
   - Token æ‰£é™¤é‚è¼¯åœ¨ orchestrator ä¸­ï¼Œä½† orchestrator æœªé‹è¡Œ

2. **æ¬¡è¦å¯èƒ½**ï¼šæ–‡ç« é€šéå…¶ä»–æµç¨‹ç”Ÿæˆ
   - å¯èƒ½æœ‰å‚™ç”¨çš„ç”Ÿæˆæµç¨‹
   - æœªç¶“é orchestrator.ts

3. **å…¶ä»–å¯èƒ½**ï¼šToken æ‰£é™¤æœå‹™å¤±æ•—
   - å‘¼å«å¤±æ•—ä½†æ²’æœ‰éŒ¯èª¤æ—¥èªŒ
   - è³‡æ–™åº«å¯«å…¥æ¬Šé™å•é¡Œ

---

### 3. è³‡æ–™åº«çµæ§‹ç¢ºèª âœ…

**company_subscriptions è¡¨**:

```sql
æ¬„ä½ç¢ºèª:
âœ… id (uuid)
âœ… company_id (uuid)
âœ… monthly_quota_balance (integer) - ç•¶å‰: 50,000
âœ… purchased_token_balance (integer) - ç•¶å‰: 0
âœ… token_balance (integer) - èˆŠæ¬„ä½ï¼Ÿç•¶å‰: 0
âœ… monthly_token_quota (integer) - é…é¡: 50,000
âœ… status (text) - ç•¶å‰: 'active'
âœ… last_token_deduction_at (timestamp) - NULL
```

**generated_articles è¡¨**:

```sql
é—œéµæ¬„ä½:
âœ… wordpress_post_id (integer) - å¤§å¤šæ•¸ç‚º NULL
âœ… wordpress_post_url (text) - å¤§å¤šæ•¸ç‚º NULL
âœ… wordpress_status (text) - 'generated', 'draft', 'published'
âœ… status (text) - 'generated', 'published'
âœ… published_to_website_id (uuid) - ç™¼ä½ˆç›®æ¨™ç¶²ç«™
```

**website_configs è¡¨**:

```sql
WordPress ç›¸é—œæ¬„ä½:
âœ… wordpress_url (text)
âœ… wp_username (text)
âœ… wp_app_password (text) - åŠ å¯†å„²å­˜
âœ… wp_enabled (boolean) - ç•¶å‰: false âš ï¸
âœ… is_active (boolean) - ç•¶å‰: true
```

---

## ğŸ“‹ ä¿®å¾©å„ªå…ˆé †åº

### P0 - ç«‹å³ä¿®å¾©ï¼ˆCriticalï¼‰

1. **Credits æ‰£é™¤å•é¡Œ**
   - è¨ºæ–· orchestrator åŸ·è¡Œç‹€æ³
   - æª¢æŸ¥ cron job è¨­å®š
   - åŠ å…¥è©³ç´°æ—¥èªŒè¿½è¹¤
   - ç¢ºä¿ token æ‰£é™¤é‚è¼¯æ­£ç¢ºåŸ·è¡Œ

2. **WordPress ç™¼ä½ˆåŠŸèƒ½**
   - å¯¦ä½œ WordPress REST API å‘¼å«
   - å„²å­˜ post ID å’Œ URL
   - åŠ å…¥éŒ¯èª¤è™•ç†å’Œå›æ»¾
   - ä¿®æ­£ `wp_enabled` æª¢æŸ¥é‚è¼¯

### P1 - é«˜å„ªå…ˆç´šï¼ˆHighï¼‰

3. **æ–‡ç« ç‹€æ…‹é¡¯ç¤º**
   - åŠ å…¥ `published` ç‹€æ…‹æ”¯æ´
   - é¡¯ç¤º WordPress ç™¼ä½ˆè³‡è¨Š
   - åŠ å…¥ç´…è‰²åœ“åœˆåœ–ç¤º

### P2 - ä¸­å„ªå…ˆç´šï¼ˆMediumï¼‰

4. **UI æ¨£å¼å„ªåŒ–**
   - èª¿æ•´æ¨™é¡Œå’Œ meta è³‡æ–™å­—é«”å¤§å°
   - åŠ å…¥ç™¼ä½ˆè³‡è¨Šé¡¯ç¤º

---

## ğŸ”§ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³åŸ·è¡Œï¼š

1. âœ… å®Œæˆè³‡æ–™åº«è¨ºæ–·
2. â­ï¸ WordPress API é€£é€šæ€§æ¸¬è©¦ï¼ˆä½¿ç”¨ curlï¼‰
3. â­ï¸ å‰ç«¯ç‹€æ…‹æª¢æŸ¥ï¼ˆä½¿ç”¨ chrome-devtoolsï¼‰

### ä¿®å¾©éšæ®µï¼š

4. â­ï¸ ä¿®å¾© WordPress ç™¼ä½ˆåŠŸèƒ½
5. â­ï¸ è¨ºæ–·ä¸¦ä¿®å¾© Credits æ‰£é™¤å•é¡Œ
6. â­ï¸ å„ªåŒ– UI é¡¯ç¤º

---

## ğŸ“Š æ•¸æ“šå¿«ç…§

**æ´»èºè¨‚é–±**: 4 å€‹å…¬å¸
**å·²ç”Ÿæˆæ–‡ç« **: 5+ ç¯‡
**Token ä½¿ç”¨è¨˜éŒ„**: 0 ç­† âš ï¸
**Token æ‰£é™¤è¨˜éŒ„**: 0 ç­† âš ï¸
**WordPress é…ç½®**: 1 å€‹ç¶²ç«™ï¼ˆwp_enabled=falseï¼‰
**å·²ç™¼ä½ˆä½† post_id ç‚º NULL**: 1 ç¯‡ âš ï¸

---

**è¨ºæ–·å®Œæˆæ™‚é–“**: 2025-01-16
**ä¸‹ä¸€æ­¥**: éšæ®µ 1.2 - WordPress API é€£é€šæ€§æ¸¬è©¦
