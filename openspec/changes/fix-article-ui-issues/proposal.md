# Fix Article UI Issues

## Problem Statement

根據用戶截圖和回饋，目前文章管理界面存在三個關鍵問題需要修復：

### 1. 關鍵字與標題生成流程混淆
**現狀問題**：
- 用戶輸入關鍵字（如「5個跡象顯示AI程式設計師即將取代人類」）
- 系統將關鍵字當作標題再次生成新標題
- 造成標題重複和混淆（關鍵字本身變成了標題，然後又生成新標題）
- 「進行中」列表出現重複項目

**期望行為**：
- 關鍵字應該作為文章主題方向，而非最終標題
- 標題確認後才加入「進行中」列表
- 避免重複和混淆的標題生成流程

### 2. Token 餘額顯示位置與更新問題
**現狀問題**：
- Token 餘額顯示在文章列表上方，位置不當
- 文章生成完成後，餘額沒有即時更新
- 需要手動刷新頁面才能看到最新餘額

**期望行為**：
- 將 Token 餘額區塊移至「文章管理」標題和「批次文章生成」按鈕之間
- 餘額顯示為：月配額 + 單次購買餘額
- 文章生成後自動更新餘額顯示

### 3. 文章預覽顯示 Markdown 而非渲染後的內容
**現狀問題**：
- 預覽區顯示原始 Markdown 語法
- 圖片無法正常顯示
- 用戶無法看到實際的文章效果

**期望行為**：
- 預覽區顯示渲染後的 HTML 內容
- 圖片正常顯示
- 完整的文章預覽體驗

## Proposed Solution

### 修復方案概覽

1. **重新設計關鍵字輸入流程**
   - 將「關鍵字」欄位改為「文章主題/關鍵字」
   - 明確標示這是主題方向，不是最終標題
   - 優化標題生成和選擇流程

2. **調整 Token 餘額顯示**
   - 重新定位餘額組件到頁面頂部中間位置
   - 實作即時更新機制（使用 SWR mutate）
   - 簡化餘額資訊顯示

3. **修復預覽渲染問題**
   - 確保文章儲存時包含 HTML 格式內容
   - 使用 dangerouslySetInnerHTML 正確渲染 HTML
   - 添加適當的 CSS 樣式支援

## Success Criteria

1. **關鍵字流程**
   - 用戶能清楚區分「主題關鍵字」和「文章標題」
   - 不再出現重複的標題生成
   - 「進行中」列表只顯示確認的標題

2. **Token 餘額**
   - 餘額顯示在正確位置
   - 文章生成後自動更新餘額
   - 清楚顯示月配額和購買餘額

3. **預覽功能**
   - 能正常顯示格式化的文字
   - 圖片能正常載入和顯示
   - 預覽效果與實際發布效果一致

## Implementation Approach

採用漸進式修復方式，優先處理用戶體驗最關鍵的問題：
1. 第一階段：修復預覽渲染（最影響使用體驗）
2. 第二階段：調整 Token 餘額位置和更新機制
3. 第三階段：優化關鍵字和標題生成流程

## Risk Mitigation

- **資料相容性**：確保修改不影響現有文章資料
- **效能考量**：Token 餘額更新使用輪詢和事件結合，避免過度請求
- **安全性**：使用 dangerouslySetInnerHTML 時確保內容已經過淨化

## Dependencies

- 需要確認現有文章資料格式
- 需要測試 Markdown 到 HTML 轉換邏輯
- 需要確認 Token 計費 API 的即時性