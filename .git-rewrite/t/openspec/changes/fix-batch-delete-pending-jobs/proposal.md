# 修復批次刪除 Pending 任務功能

## 問題描述

目前文章管理介面的批次刪除功能存在以下問題：

1. **單篇文章刪除正常**：有實際產生文章的任務可以成功刪除
2. **批次刪除失敗**：點擊「清除進行中的任務」按鈕後，顯示「已清除 0 個任務」
3. **Pending 任務無法清除**：介面上一直顯示轉圈的 pending 狀態任務，無法被批次刪除

## 根本原因分析

從代碼檢查發現：

1. **API 邏輯正確**：`/api/articles/jobs/clear` 路由已正確實作，會刪除所有非 `completed` 狀態的任務（包括 `pending`、`processing`、`failed`）
2. **前端顯示問題**：前端可能沒有正確過濾或顯示 pending 狀態的任務數量
3. **資料庫查詢問題**：可能存在權限或資料隔離問題，導致某些 pending 任務查不到但顯示在介面上

## 解決方案

1. **增強日誌記錄**：在批次刪除前後記錄詳細的任務狀態和數量
2. **修正前端顯示**：確保 `jobs.length` 正確反映需要刪除的任務數量
3. **強化資料庫查詢**：確保批次刪除能正確識別並刪除所有 pending 狀態的任務
4. **增加錯誤處理**：當刪除失敗時提供更詳細的錯誤訊息

## 影響範圍

- **前端**：`src/app/(dashboard)/dashboard/articles/page.tsx`
- **後端**：`src/app/api/articles/jobs/clear/route.ts`
- **資料庫**：`article_jobs` 表的查詢邏輯

## 驗收標準

1. 批次刪除能正確顯示待刪除的任務數量
2. 批次刪除能成功清除所有 pending 狀態的任務
3. 刪除後介面不再顯示任何轉圈的任務
4. 刪除操作提供準確的成功訊息（「已清除 N 個任務」）
5. 錯誤情況下提供清晰的錯誤訊息

## 相關文件

- 資料庫 schema：`supabase/migrations/20250101000000_init_schema.sql`
- 任務狀態定義：`supabase/migrations/20250123000000_n8n_integration.sql`
