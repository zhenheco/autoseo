{"version":3,"sources":["../src/core/client.ts","../src/core/webhook-handler.ts"],"sourcesContent":["/**\n * SyncClient\n * 用於查詢同步到本地的文章\n */\n\nimport { createClient, SupabaseClient } from \"@supabase/supabase-js\";\nimport type {\n  SyncClientConfig,\n  GetArticlesOptions,\n  GetArticlesResponse,\n  GetArticleResponse,\n  SyncedArticle,\n  SyncedArticleListItem,\n} from \"./types\";\n\nconst DEFAULT_TABLE_NAME = \"synced_articles\";\nconst DEFAULT_LIMIT = 10;\n\n/**\n * SyncClient 類別\n * 提供文章查詢功能\n */\nexport class SyncClient {\n  private supabase: SupabaseClient;\n  private tableName: string;\n\n  constructor(config: SyncClientConfig) {\n    this.tableName = config.tableName || DEFAULT_TABLE_NAME;\n    this.supabase = createClient(config.supabaseUrl, config.supabaseKey);\n  }\n\n  /**\n   * 取得文章列表\n   */\n  async getArticles(\n    options: GetArticlesOptions = {}\n  ): Promise<GetArticlesResponse> {\n    const {\n      limit = DEFAULT_LIMIT,\n      offset = 0,\n      language,\n      category,\n      tag,\n      sortBy = \"published_at\",\n      sortOrder = \"desc\",\n    } = options;\n\n    // 建立查詢\n    let query = this.supabase\n      .from(this.tableName)\n      .select(\n        `\n        id,\n        slug,\n        title,\n        excerpt,\n        featured_image_url,\n        categories,\n        tags,\n        language,\n        reading_time,\n        published_at\n      `,\n        { count: \"exact\" }\n      )\n      .eq(\"sync_status\", \"active\");\n\n    // 篩選條件\n    if (language) {\n      query = query.eq(\"language\", language);\n    }\n\n    if (category) {\n      query = query.contains(\"categories\", [category]);\n    }\n\n    if (tag) {\n      query = query.contains(\"tags\", [tag]);\n    }\n\n    // 排序\n    query = query.order(sortBy, { ascending: sortOrder === \"asc\" });\n\n    // 分頁\n    query = query.range(offset, offset + limit - 1);\n\n    const { data, error, count } = await query;\n\n    if (error) {\n      throw new Error(`Failed to fetch articles: ${error.message}`);\n    }\n\n    const total = count || 0;\n    const hasMore = offset + limit < total;\n\n    return {\n      articles: (data || []) as SyncedArticleListItem[],\n      total,\n      hasMore,\n    };\n  }\n\n  /**\n   * 根據 slug 取得單篇文章\n   */\n  async getArticleBySlug(slug: string): Promise<GetArticleResponse> {\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .select(\"*\")\n      .eq(\"slug\", slug)\n      .eq(\"sync_status\", \"active\")\n      .single();\n\n    if (error) {\n      if (error.code === \"PGRST116\") {\n        // 找不到資料\n        return { article: null };\n      }\n      throw new Error(`Failed to fetch article: ${error.message}`);\n    }\n\n    return { article: data as SyncedArticle };\n  }\n\n  /**\n   * 根據 source_id 取得單篇文章\n   */\n  async getArticleBySourceId(sourceId: string): Promise<GetArticleResponse> {\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .select(\"*\")\n      .eq(\"source_id\", sourceId)\n      .eq(\"sync_status\", \"active\")\n      .single();\n\n    if (error) {\n      if (error.code === \"PGRST116\") {\n        return { article: null };\n      }\n      throw new Error(`Failed to fetch article: ${error.message}`);\n    }\n\n    return { article: data as SyncedArticle };\n  }\n\n  /**\n   * 取得所有分類\n   */\n  async getCategories(): Promise<string[]> {\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .select(\"categories\")\n      .eq(\"sync_status\", \"active\");\n\n    if (error) {\n      throw new Error(`Failed to fetch categories: ${error.message}`);\n    }\n\n    // 合併所有分類並去重\n    const allCategories = new Set<string>();\n    for (const row of data || []) {\n      for (const cat of row.categories || []) {\n        allCategories.add(cat);\n      }\n    }\n\n    return Array.from(allCategories).sort();\n  }\n\n  /**\n   * 取得所有標籤\n   */\n  async getTags(): Promise<string[]> {\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .select(\"tags\")\n      .eq(\"sync_status\", \"active\");\n\n    if (error) {\n      throw new Error(`Failed to fetch tags: ${error.message}`);\n    }\n\n    // 合併所有標籤並去重\n    const allTags = new Set<string>();\n    for (const row of data || []) {\n      for (const tag of row.tags || []) {\n        allTags.add(tag);\n      }\n    }\n\n    return Array.from(allTags).sort();\n  }\n\n  /**\n   * 取得相關文章\n   */\n  async getRelatedArticles(\n    articleId: string,\n    limit: number = 4\n  ): Promise<SyncedArticleListItem[]> {\n    // 先取得目標文章的分類和標籤\n    const { data: targetArticle, error: fetchError } = await this.supabase\n      .from(this.tableName)\n      .select(\"categories, tags\")\n      .eq(\"id\", articleId)\n      .single();\n\n    if (fetchError || !targetArticle) {\n      return [];\n    }\n\n    const categories = targetArticle.categories || [];\n    const tags = targetArticle.tags || [];\n\n    // 查詢有相同分類或標籤的文章\n    let query = this.supabase\n      .from(this.tableName)\n      .select(\n        `\n        id,\n        slug,\n        title,\n        excerpt,\n        featured_image_url,\n        categories,\n        tags,\n        language,\n        reading_time,\n        published_at\n      `\n      )\n      .eq(\"sync_status\", \"active\")\n      .neq(\"id\", articleId);\n\n    // 有分類或標籤時篩選相關文章\n    if (categories.length > 0 || tags.length > 0) {\n      // 優先使用分類篩選，如果沒有分類則使用標籤\n      if (categories.length > 0) {\n        query = query.overlaps(\"categories\", categories);\n      } else if (tags.length > 0) {\n        query = query.overlaps(\"tags\", tags);\n      }\n    }\n\n    query = query\n      .order(\"published_at\", { ascending: false })\n      .limit(limit);\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error(\"[SyncClient] Failed to fetch related articles:\", error);\n      return [];\n    }\n\n    return (data || []) as SyncedArticleListItem[];\n  }\n\n  /**\n   * 搜尋文章\n   */\n  async searchArticles(\n    query: string,\n    options: GetArticlesOptions = {}\n  ): Promise<GetArticlesResponse> {\n    const { limit = DEFAULT_LIMIT, offset = 0, language } = options;\n\n    // 使用 ilike 進行簡單的文字搜尋\n    // 注意：對於大規模搜尋，建議使用 Supabase 的 Full Text Search\n    let dbQuery = this.supabase\n      .from(this.tableName)\n      .select(\n        `\n        id,\n        slug,\n        title,\n        excerpt,\n        featured_image_url,\n        categories,\n        tags,\n        language,\n        reading_time,\n        published_at\n      `,\n        { count: \"exact\" }\n      )\n      .eq(\"sync_status\", \"active\")\n      .or(`title.ilike.%${query}%,excerpt.ilike.%${query}%`);\n\n    if (language) {\n      dbQuery = dbQuery.eq(\"language\", language);\n    }\n\n    dbQuery = dbQuery\n      .order(\"published_at\", { ascending: false })\n      .range(offset, offset + limit - 1);\n\n    const { data, error, count } = await dbQuery;\n\n    if (error) {\n      throw new Error(`Failed to search articles: ${error.message}`);\n    }\n\n    const total = count || 0;\n    const hasMore = offset + limit < total;\n\n    return {\n      articles: (data || []) as SyncedArticleListItem[],\n      total,\n      hasMore,\n    };\n  }\n\n  /**\n   * 取得文章數量\n   */\n  async getArticleCount(language?: string): Promise<number> {\n    let query = this.supabase\n      .from(this.tableName)\n      .select(\"*\", { count: \"exact\", head: true })\n      .eq(\"sync_status\", \"active\");\n\n    if (language) {\n      query = query.eq(\"language\", language);\n    }\n\n    const { count, error } = await query;\n\n    if (error) {\n      throw new Error(`Failed to count articles: ${error.message}`);\n    }\n\n    return count || 0;\n  }\n}\n\n/**\n * 建立 SyncClient 實例\n */\nexport function createSyncClient(config: SyncClientConfig): SyncClient {\n  return new SyncClient(config);\n}\n","/**\n * Webhook Handler\n * 接收和處理來自 1waySEO 的文章同步 webhook\n */\n\nimport { createClient, SupabaseClient } from \"@supabase/supabase-js\";\nimport type {\n  WebhookHandlerConfig,\n  WebhookPayload,\n  WebhookHandlerResult,\n  SignatureVerificationResult,\n  SyncedArticle,\n} from \"./types\";\n\nconst SIGNATURE_HEADER = \"x-webhook-signature\";\nconst TIMESTAMP_HEADER = \"x-webhook-timestamp\";\nconst DEFAULT_TABLE_NAME = \"synced_articles\";\n\n/**\n * 驗證 HMAC-SHA256 簽章\n */\nexport function verifyWebhookSignature(\n  payload: string,\n  secret: string,\n  signature: string,\n  timestamp: number,\n  maxAgeMs: number = 5 * 60 * 1000\n): SignatureVerificationResult {\n  // 檢查時間戳是否在有效範圍內\n  const now = Date.now();\n  const age = now - timestamp;\n\n  if (age > maxAgeMs) {\n    return {\n      valid: false,\n      error: `Signature expired. Age: ${age}ms, Max: ${maxAgeMs}ms`,\n    };\n  }\n\n  if (age < -60000) {\n    return {\n      valid: false,\n      error: \"Signature timestamp is in the future\",\n    };\n  }\n\n  // 生成預期的簽章並比對\n  const signaturePayload = `${timestamp}.${payload}`;\n\n  // 注意：這是同步版本，實際使用時建議用 async 版本\n  // 為了支援更廣泛的環境，這裡使用同步比對\n  const expectedSignature = generateSignatureSync(signaturePayload, secret);\n\n  if (signature !== expectedSignature) {\n    return { valid: false, error: \"Invalid signature\" };\n  }\n\n  return { valid: true };\n}\n\n/**\n * 同步生成簽章（使用 Node.js crypto 或 Web Crypto）\n */\nfunction generateSignatureSync(payload: string, secret: string): string {\n  // 嘗試使用 Node.js crypto（較快）\n  try {\n    const crypto = require(\"crypto\");\n    const hmac = crypto.createHmac(\"sha256\", secret);\n    hmac.update(payload, \"utf8\");\n    return `sha256=${hmac.digest(\"hex\")}`;\n  } catch {\n    // 如果在瀏覽器環境，這個函數不應該被調用\n    // Webhook 處理應該在伺服器端\n    throw new Error(\"Webhook verification must be done on the server side\");\n  }\n}\n\n/**\n * Webhook Handler 類別\n */\nexport class WebhookHandler {\n  private supabase: SupabaseClient;\n  private webhookSecret: string;\n  private tableName: string;\n  private onArticleCreated?: WebhookHandlerConfig[\"onArticleCreated\"];\n  private onArticleUpdated?: WebhookHandlerConfig[\"onArticleUpdated\"];\n  private onArticleDeleted?: WebhookHandlerConfig[\"onArticleDeleted\"];\n\n  constructor(config: WebhookHandlerConfig) {\n    this.webhookSecret = config.webhookSecret;\n    this.tableName = config.tableName || DEFAULT_TABLE_NAME;\n    this.supabase = createClient(config.supabaseUrl, config.supabaseKey);\n    this.onArticleCreated = config.onArticleCreated;\n    this.onArticleUpdated = config.onArticleUpdated;\n    this.onArticleDeleted = config.onArticleDeleted;\n  }\n\n  /**\n   * 處理 Webhook 請求\n   */\n  async handleWebhook(\n    body: string,\n    signature: string | null,\n    timestamp: string | null\n  ): Promise<WebhookHandlerResult> {\n    // 驗證簽章\n    if (!signature || !timestamp) {\n      return {\n        success: false,\n        error: \"Missing signature or timestamp headers\",\n      };\n    }\n\n    const timestampNum = parseInt(timestamp, 10);\n    if (isNaN(timestampNum)) {\n      return {\n        success: false,\n        error: \"Invalid timestamp\",\n      };\n    }\n\n    const verifyResult = verifyWebhookSignature(\n      body,\n      this.webhookSecret,\n      signature,\n      timestampNum\n    );\n\n    if (!verifyResult.valid) {\n      return {\n        success: false,\n        error: verifyResult.error || \"Invalid signature\",\n      };\n    }\n\n    // 解析 payload\n    let payload: WebhookPayload;\n    try {\n      payload = JSON.parse(body);\n    } catch {\n      return {\n        success: false,\n        error: \"Invalid JSON payload\",\n      };\n    }\n\n    // 根據事件類型處理\n    try {\n      switch (payload.event) {\n        case \"article.created\":\n          return await this.handleArticleCreated(payload);\n        case \"article.updated\":\n          return await this.handleArticleUpdated(payload);\n        case \"article.deleted\":\n          return await this.handleArticleDeleted(payload);\n        default:\n          return {\n            success: false,\n            error: `Unknown event type: ${payload.event}`,\n          };\n      }\n    } catch (error) {\n      console.error(\"[WebhookHandler] 處理錯誤:\", error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      };\n    }\n  }\n\n  /**\n   * 處理文章建立事件\n   */\n  private async handleArticleCreated(\n    payload: WebhookPayload\n  ): Promise<WebhookHandlerResult> {\n    const articleData = this.mapPayloadToArticle(payload);\n\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .upsert(articleData, { onConflict: \"source_id\" })\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: `Database error: ${error.message}`,\n      };\n    }\n\n    // 呼叫 callback\n    if (this.onArticleCreated) {\n      await this.onArticleCreated(data as SyncedArticle);\n    }\n\n    return {\n      success: true,\n      message: \"Article created successfully\",\n      article_id: data.id,\n    };\n  }\n\n  /**\n   * 處理文章更新事件\n   */\n  private async handleArticleUpdated(\n    payload: WebhookPayload\n  ): Promise<WebhookHandlerResult> {\n    const articleData = this.mapPayloadToArticle(payload);\n\n    const { data, error } = await this.supabase\n      .from(this.tableName)\n      .upsert(articleData, { onConflict: \"source_id\" })\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: `Database error: ${error.message}`,\n      };\n    }\n\n    // 呼叫 callback\n    if (this.onArticleUpdated) {\n      await this.onArticleUpdated(data as SyncedArticle);\n    }\n\n    return {\n      success: true,\n      message: \"Article updated successfully\",\n      article_id: data.id,\n    };\n  }\n\n  /**\n   * 處理文章刪除事件\n   */\n  private async handleArticleDeleted(\n    payload: WebhookPayload\n  ): Promise<WebhookHandlerResult> {\n    const sourceId = payload.article.source_id;\n\n    // 軟刪除：更新狀態為 deleted\n    const { error } = await this.supabase\n      .from(this.tableName)\n      .update({\n        sync_status: \"deleted\",\n        updated_at: new Date().toISOString(),\n      })\n      .eq(\"source_id\", sourceId);\n\n    if (error) {\n      return {\n        success: false,\n        error: `Database error: ${error.message}`,\n      };\n    }\n\n    // 呼叫 callback\n    if (this.onArticleDeleted) {\n      await this.onArticleDeleted(sourceId);\n    }\n\n    return {\n      success: true,\n      message: \"Article deleted successfully\",\n    };\n  }\n\n  /**\n   * 將 Webhook Payload 映射到文章資料\n   */\n  private mapPayloadToArticle(payload: WebhookPayload): Record<string, unknown> {\n    const article = payload.article;\n    const now = new Date().toISOString();\n\n    return {\n      source_id: article.source_id,\n      slug: article.slug,\n      title: article.title,\n      excerpt: article.excerpt,\n      html_content: article.html_content,\n      markdown_content: article.markdown_content || null,\n      categories: article.categories || [],\n      tags: article.tags || [],\n      language: article.language || \"zh-TW\",\n      seo_title: article.seo_title,\n      seo_description: article.seo_description,\n      focus_keyword: article.focus_keyword,\n      keywords: article.keywords || [],\n      featured_image_url: article.featured_image_url,\n      featured_image_alt: article.featured_image_alt,\n      word_count: article.word_count,\n      reading_time: article.reading_time,\n      published_at: article.published_at,\n      synced_at: now,\n      sync_status: \"active\",\n      updated_at: now,\n    };\n  }\n\n  /**\n   * 取得簽章和時間戳 header 名稱\n   */\n  static get SIGNATURE_HEADER(): string {\n    return SIGNATURE_HEADER;\n  }\n\n  static get TIMESTAMP_HEADER(): string {\n    return TIMESTAMP_HEADER;\n  }\n}\n\n/**\n * 建立 Webhook Handler 實例\n */\nexport function createWebhookHandler(\n  config: WebhookHandlerConfig\n): WebhookHandler {\n  return new WebhookHandler(config);\n}\n"],"mappings":"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","names":["createClient","DEFAULT_TABLE_NAME"]}