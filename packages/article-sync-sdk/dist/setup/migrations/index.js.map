{"version":3,"sources":["../../../src/setup/migrations/index.ts"],"sourcesContent":["/**\n * @1wayseo/article-sync-sdk/migrations\n * 資料庫 Migration\n */\n\n/**\n * synced_articles 表的 Migration SQL\n */\nexport const SYNCED_ARTICLES_MIGRATION = `\n-- =============================================\n-- Migration: synced_articles\n-- 同步文章表（供外部專案使用）\n-- 來自 @1wayseo/article-sync-sdk\n-- =============================================\n\n-- 創建 synced_articles 表\nCREATE TABLE IF NOT EXISTS synced_articles (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n\n  -- 來源識別\n  source_id TEXT NOT NULL UNIQUE,        -- 1waySEO 的 article ID\n  slug TEXT NOT NULL,\n\n  -- 內容\n  title TEXT NOT NULL,\n  excerpt TEXT,\n  html_content TEXT,\n  markdown_content TEXT,\n\n  -- 分類和標籤\n  categories TEXT[] DEFAULT '{}',\n  tags TEXT[] DEFAULT '{}',\n\n  -- 多語系\n  language TEXT NOT NULL DEFAULT 'zh-TW',\n\n  -- SEO\n  seo_title TEXT,\n  seo_description TEXT,\n  focus_keyword TEXT,\n  keywords TEXT[] DEFAULT '{}',\n\n  -- 媒體\n  featured_image_url TEXT,\n  featured_image_alt TEXT,\n\n  -- 閱讀資訊\n  word_count INTEGER,\n  reading_time INTEGER,\n\n  -- 時間戳記\n  published_at TIMESTAMPTZ,\n  synced_at TIMESTAMPTZ DEFAULT NOW(),\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW(),\n\n  -- 同步狀態\n  sync_status TEXT DEFAULT 'active' CHECK (sync_status IN ('active', 'deleted'))\n);\n\n-- 創建索引\nCREATE INDEX IF NOT EXISTS idx_synced_articles_slug ON synced_articles(slug);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_source_id ON synced_articles(source_id);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_language ON synced_articles(language);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_status ON synced_articles(sync_status);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_published_at ON synced_articles(published_at DESC);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_categories ON synced_articles USING GIN(categories);\nCREATE INDEX IF NOT EXISTS idx_synced_articles_tags ON synced_articles USING GIN(tags);\n\n-- 創建 updated_at 觸發器\nCREATE OR REPLACE FUNCTION update_synced_articles_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nDROP TRIGGER IF EXISTS trigger_synced_articles_updated_at ON synced_articles;\nCREATE TRIGGER trigger_synced_articles_updated_at\n  BEFORE UPDATE ON synced_articles\n  FOR EACH ROW\n  EXECUTE FUNCTION update_synced_articles_updated_at();\n\n-- RLS 政策（可選：根據需求調整）\nALTER TABLE synced_articles ENABLE ROW LEVEL SECURITY;\n\n-- 公開讀取：所有人可以查看已發布的文章\nCREATE POLICY \"Public can read active articles\" ON synced_articles\n  FOR SELECT\n  USING (sync_status = 'active');\n\n-- 添加註解\nCOMMENT ON TABLE synced_articles IS '同步自 1waySEO 的文章';\nCOMMENT ON COLUMN synced_articles.source_id IS '1waySEO 的文章 ID';\nCOMMENT ON COLUMN synced_articles.sync_status IS '同步狀態：active（有效）、deleted（已刪除）';\n`;\n\n/**\n * 取得 Migration SQL\n */\nexport function getMigrationSQL(): string {\n  return SYNCED_ARTICLES_MIGRATION;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQO,IAAM,4BAA4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6FlC,SAAS,kBAA0B;AACxC,SAAO;AACT;","names":[]}